# tmux-mobile

Mobile-first tmux web client with a Node.js backend and React + xterm frontend.

Use it to control your tmux server from a phone browser, locally or over a Cloudflare quick tunnel.

## Quick Start

### Run without cloning (recommended)

```bash
npx tmux-mobile
```

The CLI prints:
- `Local URL: ...?token=...`
- `Tunnel URL: ...?token=...` (when tunnel is enabled)
- `Password: ...` (when password auth is enabled)

Open either URL directly on your phone.

### Run from source

```bash
npm install
npm run build
node dist/backend/cli.js
```

## Security Defaults

- Password authentication is enabled by default.
- If you do not provide `--password`, a random password is generated.
- Password is printed separately (not in URL query parameters).
- You can disable password checks for trusted local workflows with `--no-require-password`.

## Versioning

- The project intentionally stays on `0.0.x` while the interface and operational behavior are still being refined.

## CLI

```bash
tmux-mobile [options]

Options:
  -p, --port <port>                Local port (default: 8767)
  --password <pass>                Authentication password (optional; auto-generated by default)
  --[no-]require-password          Toggle password requirement (default: true)
  --no-tunnel                      Don't start cloudflared tunnel
  --session <name>                 Default tmux session name (default: main)
  --scrollback <lines>             Default scrollback capture lines (default: 1000)
  --debug-log <path>               Write backend debug logs to a file
```

Optional environment variables:

- `TMUX_MOBILE_SOCKET_NAME`: use a dedicated tmux socket name (`tmux -L`) for isolation
- `TMUX_MOBILE_SOCKET_PATH`: use an explicit tmux socket path (`tmux -S`)
- `TMUX_MOBILE_DEBUG_LOG`: alternative way to enable debug log file output
- `TMUX_MOBILE_FORCE_SCRIPT_PTY=1`: force the Unix `script(1)` PTY fallback

## Local Development

```bash
npm run dev
```

Quality gate:

```bash
npm run typecheck
npm test
npm run test:e2e
npm run build
```

## Test Harness

The automated harness avoids manual QA by validating the tmux protocol flow end-to-end:

- `FakeTmuxGateway`: in-memory tmux session/window/pane state machine
- `FakePtyFactory`: captures terminal writes/resizes and emits PTY output
- Integration tests for auth, attach flow, session picker, mutations, scrollback capture, and terminal I/O bridge
- Playwright browser tests for attach + terminal rendering, drawer behavior, and session selection regression coverage
- Optional real tmux smoke test:

```bash
npm run test:smoke
```

## GitHub Actions

- `CI` (`.github/workflows/ci.yml`)
  - runs typecheck, tests, build, and `npm pack --dry-run` on push/PR
  - runs browser E2E tests (Playwright Chromium)
  - runs a real tmux smoke job on Ubuntu
- `Publish` (`.github/workflows/publish.yml`)
  - triggered manually or by GitHub Release publish
  - runs tests + build and publishes to npm with provenance

Required repository secret for publish:

- `NPM_TOKEN`: npm automation token with publish rights for `tmux-mobile`
